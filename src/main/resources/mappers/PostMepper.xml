<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.proj.instagram.post.PostDAO">

    <select id="findByUserEmail" parameterType="String" resultType="PostDTO">
            SELECT POST_ID AS postId,
           EMAIL AS email,
           CONTENT AS content,
           IMAGE_PATH AS imagePath,
           CREATED_AT AS createdAt
    FROM insta_post
    WHERE EMAIL = #{email}
    </select>

    <insert id="savePost" parameterType="PostDTO">
        INSERT INTO insta_post (EMAIL, CONTENT, IMAGE_PATH, CREATED_AT)
        VALUES (#{email}, #{content}, #{imagePath, jdbcType=VARCHAR}, SYSDATE)
    </insert>

    <select id="getLatestPostId" parameterType="String" resultType="int">
        SELECT MAX(POST_ID) FROM insta_post WHERE EMAIL = #{email}
    </select>

    <update id="updatePost" parameterType="PostDTO">
        UPDATE insta_post 
        SET CONTENT = #{content}, IMAGE_PATH = #{imagePath} 
        WHERE POST_ID = #{postId}
    </update>


    <!-- 게시글 조회 by postId -->
    <select id="getPostById" parameterType="long" resultType="PostDTO">
        SELECT post_id, email, content, image_path, created_at
        FROM insta_post
        WHERE post_id = #{postId}
    </select>

    <!-- 댓글 조회 by postId -->
    <select id="getRepliesByPostId" parameterType="long" resultType="ReplyDTO">
        SELECT reply_id, post_id, email, comments, created_at
        FROM insta_reply
        WHERE post_id = #{postId}
    </select>
</mapper>